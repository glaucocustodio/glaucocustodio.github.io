---
layout: post
status: publish
published: true
title: Otimizando Performance com Compacta&ccedil;&atilde;o Gzip&#47;Deflate
author:
  display_name: Glauco Custódio
  login: glauco-custodio
  email: glauco.custodio@gmail.com
  url: http://glaucocustodio.com
author_login: glauco-custodio
author_email: glauco.custodio@gmail.com
author_url: http://glaucocustodio.com
excerpt: "Fala pessoal, beleza?\r\n\r\nHoje estou aqui para falar de um assunto que
  pode n&atilde;o ser muito conhecido por alguns, que &eacute; a <strong>compacta&ccedil;&atilde;o
  gzip&#47;deflate<&#47;strong>.\r\n\r\nEssa t&eacute;cnica, nada mais &eacute; do
  que a compacta&ccedil;&atilde;o dos arquivos solicitados pelo navegador (browser)
  antes deles serem enviados pelo servidor.\r\n\r\n<a href=\"http:&#47;&#47;blog.glaucocustodio.com&#47;2012&#47;09&#47;22&#47;otimizando-performance-com-compactacao-gzip-deflate&#47;\"><img
  class=\"alignnone  wp-image-490\" title=\"gzip-deflate-compression\" src=\"http:&#47;&#47;blog.glaucocustodio.com&#47;wp-content&#47;uploads&#47;2012&#47;09&#47;gzip-deflate-compression.jpg\"
  alt=\"gzip-deflate-compression\" width=\"580\" height=\"240\" &#47;><&#47;a>\r\n<h2>"
wordpress_id: 479
wordpress_url: http://blog.glaucocustodio.com/?p=479
date: '2012-09-22 15:54:49 -0300'
date_gmt: '2012-09-22 15:54:49 -0300'
categories:
- Servidor
tags:
- apache
- servidor
- gzip
comments:
- id: 37
  author: BrunoArruda
  author_email: contato@brunoarruda.com.br
  author_url: http://www.brunoarruda.com.br/
  date: '2012-09-25 16:33:30 -0300'
  date_gmt: '2012-09-25 16:33:30 -0300'
  content: "Parab&eacute;ns Glauco, me auxiliou bastante na otimiza&ccedil;&atilde;o
    do meu site, excelente artigo, muito bem explicado continue com essa did&aacute;tica
    que esta muito boa.\r\nParab&eacute;ns novamente e sucesso!"
- id: 43
  author: yan
  author_email: yanklovinsk@gmail.com
  author_url: http://www.yanklovinsk.com.br
  date: '2012-10-03 17:56:40 -0300'
  date_gmt: '2012-10-03 17:56:40 -0300'
  content: "Tudo legal quando pensamos em wordpress. Entretanto tenho um blog no blogger,
    ent&atilde;o como utilizar o gzip nele, al&eacute;m disso tenho dois arquivos
    externos .js e .css onde est&atilde;o todos os scripts s&oacute; que o pagespeed
    pede para usar o gzip e n&atilde;o sei como fazer. Glauco pode me ajudar. Agrade&ccedil;o
    antecipadamente.\r\n\r\nYan"
- id: 129
  author: Flowck II
  author_email: flowck96@hotmail.com
  author_url: http://webvisao.wordpress.com
  date: '2012-12-01 21:45:07 -0200'
  date_gmt: '2012-12-01 21:45:07 -0200'
  content: Gostei muito do post, muito claro e pratico mas voc&ecirc; apenas mostrou
    como ativar o modulo deflate no servidor local, e caso este modulo ou o gzip n&atilde;o
    estiver ativado no host em que eu hospedei o meu site?
- id: 251
  author: Paulo Benitez
  author_email: paulo.bntz@gmail.com
  author_url: ''
  date: '2012-12-13 14:19:22 -0200'
  date_gmt: '2012-12-13 14:19:22 -0200'
  content: Muito bem explicado. &Oacute;timo artigo.
- id: 322
  author: Alexandre
  author_email: editor@androidcabecao.com.br
  author_url: http://androidcabecao.com.br/
  date: '2013-01-23 00:27:01 -0200'
  date_gmt: '2013-01-23 00:27:01 -0200'
  content: "Opa amigo! Eu tenho um problema no wp. &Eacute; o seguinte, quando eu
    fa&ccedil;o upload de imagens para inserir em artigos, o wp cria uma p&aacute;gina
    para essa imagem, como se fosse uma postagem. Se algu&eacute;m clica na imagem
    dentro do artigo original para o qual a imagem foi uploadada, ser&aacute; direcionado
    para uma postagem com a imagem e informa&ccedil;&otilde;es, como descri&ccedil;&atilde;o,
    etc, ect.\r\n\r\nUm exemplo &eacute; o artigo http:&#47;&#47;androidcabecao.com.br&#47;ubuntu-phone-os-sera-que-encaixa&#47;\r\n\r\nSe
    algu&eacute;m clicar na imagem com a foto do artigo, uma nova p&aacute;gina &eacute;
    aberta com a imagem e a descri&ccedil;&atilde;o.\r\n\r\nEu gostaria de saber como
    removo isso. Porque logo quando eu comecei com o WP, se eu clicasse na imagem,
    abria apenas a imagem. E queria q isso voltasse. Obrigado"
- id: 676
  author: Willian Abreu
  author_email: willian.abreu2726@gmail.com
  author_url: ''
  date: '2013-06-04 14:10:05 -0300'
  date_gmt: '2013-06-04 14:10:05 -0300'
  content: Parab&eacute;ns pela explica&ccedil;&atilde;o!
- id: 735
  author: Thiago Nunes
  author_email: thiagonunes30@gmail.com
  author_url: ''
  date: '2013-06-20 16:04:31 -0300'
  date_gmt: '2013-06-20 16:04:31 -0300'
  content: "&Oacute;tima explica&ccedil;&atilde;o, vai me ajudar em um trabalho de
    otimiza&ccedil;&atilde;o que estou fazendo para um portal.\r\n\r\nObrigado!"
- id: 1118
  author: gadarf
  author_email: gadarf@mmosgame.com
  author_url: http://mmosgame.com/
  date: '2013-08-13 12:05:08 -0300'
  date_gmt: '2013-08-13 12:05:08 -0300'
  content: Vou testar, espero que minha hospedagem tenha isso ativado.
- id: 1170
  author: Rodrigo
  author_email: rodrigo@immitec.com
  author_url: http://www.ImmiFlex.com
  date: '2013-08-27 19:24:35 -0300'
  date_gmt: '2013-08-27 19:24:35 -0300'
  content: "Eu preciso usar compress&atilde;o em minhas p&aacute;ginas&#47;imagens&#47;scripts,
    mas meu hosting me informou que o gzip e deflate n&atilde;o est&atilde;o dispon&iacute;veis
    para mim porque uso servidor compartilhado e me recomendou usar ZLib. ZLib est&aacute;
    Ativado e On no meu servidor. E a documenta&ccedil;&atilde;o php est&aacute; dizendo
    que eu preciso adicionar \"Accept-Encoding: gzip\" no cabe&ccedil;alho do HTTP,
    mas n&atilde;o tenho ideia de como fazer isso e n&atilde;o estou encontrando na
    internet.\r\n\r\nPoderiam me ajudar?"
- id: 1335
  author: Gabriel Martins
  author_email: gabrirock1@hotmail.com
  author_url: http://www.criarsitewix.com/
  date: '2013-10-06 22:39:31 -0300'
  date_gmt: '2013-10-06 22:39:31 -0300'
  content: "Aqui ficou dando erro 500 internal servir error...n&atilde;o funcoinaou.\r\n\r\nAbra&ccedil;o!"
- id: 1610
  author: romulo paulo
  author_email: rmulopaulo@hotmail.com
  author_url: http://www.rclique.com.br
  date: '2014-01-30 03:17:59 -0200'
  date_gmt: '2014-01-30 03:17:59 -0200'
  content: muito bom vou fazer no meu site, gostei
- id: 1951
  author: Dinilson Mar&ccedil;al
  author_email: dinilsonmarcal@hotmail.com
  author_url: http://mapadecursosonline.com/
  date: '2014-04-14 21:49:58 -0300'
  date_gmt: '2014-04-14 21:49:58 -0300'
  content: "Ol&aacute; Glauco Cust&oacute;dio!\r\n\r\nO seu artigo foi muito &uacute;til.
    Obrigado pela dica!\r\n\r\nPaz e ben&ccedil;&atilde;os,\r\n\r\n\r\nDinilson Mar&ccedil;al"
- id: 1952
  author: Dinilson Mar&ccedil;al
  author_email: dinilsonmarcal@hotmail.com
  author_url: http://mapadecursosonline.com/
  date: '2014-04-14 22:18:24 -0300'
  date_gmt: '2014-04-14 22:18:24 -0300'
  content: "Ol&aacute; Glauco Cust&oacute;dio!\r\n\r\nN&atilde;o consegui realizar
    esta etapa \"vamos colocar em pr&aacute;tica ativando ela no servidor web Apache.\".
    Caso possa fornecer mais detalhes sobre isso eu agrade&ccedil;o. \r\n\r\nQue as
    melhores coisas aconte&ccedil;am na sua vida!\r\n\r\nDinilson Mar&ccedil;al"
- id: 2287
  author: Assistencia Importados
  author_email: assistenciaimportados@gmail.com
  author_url: http://www.assistenciaimportados.com.br/
  date: '2014-05-14 20:06:45 -0300'
  date_gmt: '2014-05-14 20:06:45 -0300'
  content: Muito bem explicado, &oacute;timo artigo.
- id: 2311
  author: Assistencia Tecnica Bosch
  author_email: boschassistenciatecnica@gmail.com
  author_url: http://www.boschassistenciatecnica.com/
  date: '2014-05-20 19:40:59 -0300'
  date_gmt: '2014-05-20 19:40:59 -0300'
  content: Muito bem explicado
- id: 8194
  author: Deuzebra na Web &raquo; Otimizando Performance com Compacta&ccedil;&atilde;o
    Gzip&#47;Deflate
  author_email: ''
  author_url: http://www.deuzebranaweb.com.br/otimizando-performance-com-compactacao-gzipdeflate/
  date: '2014-09-09 21:21:28 -0300'
  date_gmt: '2014-09-09 21:21:28 -0300'
  content: "[...] Otimizando Performance com Compacta&ccedil;&atilde;o Gzip&#47;Deflate
    \   Fala pessoal, beleza? [...]"
- id: 11732
  author: Eloah Cristina
  author_email: contato@marolacomcarambola.com.br
  author_url: http://www.conexaofotografica.com.br
  date: '2014-10-03 03:57:36 -0300'
  date_gmt: '2014-10-03 03:57:36 -0300'
  content: "Eu coloquei esse trecho no meu arquivo httacess.. por&eacute;m ele deixa
    o site com o recado \"Erro interno do Servidor!\"\r\nSabe me auxiliar o que pode
    estar errado?\r\nAbra&ccedil;os,"
- id: 11733
  author: Eloah Cristina
  author_email: contato@marolacomcarambola.com.br
  author_url: http://www.conexaofotografica.com.br
  date: '2014-10-03 04:01:53 -0300'
  date_gmt: '2014-10-03 04:01:53 -0300'
  content: "Ah, na verdade o que d&aacute; erro &eacute; o seguinte trecho\r\n\r\n\"#
    Netscape 4.x has some problems...\r\nBrowserMatch ^Mozilla&#47;4 gzip-only-text&#47;html\r\n\r\n#
    Netscape 4.06-4.08 have some more problems\r\nBrowserMatch ^Mozilla&#47;4.0[678]
    no-gzip\r\n\r\n# MSIE masquerades as Netscape, but it is fine\r\n# BrowserMatch
    \bMSIE !no-gzip !gzip-only-text&#47;html\r\n\r\n# NOTE: Due to a bug in mod_setenvif
    up to Apache 2.0.48\r\n# the above regex won't work. You can use the following\r\n#
    workaround to get the desired effect:\r\nBrowserMatch \bMSI[E] !no-gzip !gzip-only-text&#47;html\r\n\r\n#
    Don't compress images\r\nSetEnvIfNoCase Request_URI \r\n.(?:gif|jpe?g|png)$ no-gzip
    dont-vary\"\r\n\r\nSe eu n&atilde;o usar, tudo bem?"
- id: 20092
  author: Gustavo Matias
  author_email: ghmmatias@gmail.com
  author_url: http://www.ghmm.com.br
  date: '2015-01-16 17:48:55 -0200'
  date_gmt: '2015-01-16 17:48:55 -0200'
  content: Excelente! Parab&eacute;ns e obrigado pela explica&ccedil;&atilde;o clara.
- id: 21041
  author: Victor Hugo Santana
  author_email: arquiteto.victorhugo@gmail.com
  author_url: http://rendaconstante.com
  date: '2015-01-27 00:35:50 -0200'
  date_gmt: '2015-01-27 00:35:50 -0200'
  content: "&Oacute;tima explica&ccedil;&atilde;o!"
- id: 31554
  author: Jonny Ken
  author_email: web@jonnyken.com
  author_url: http://migre.me
  date: '2015-05-26 23:41:49 -0300'
  date_gmt: '2015-05-26 23:41:49 -0300'
  content: "&Oacute;timo artigo. Mas importante lembrar que a maioria de arquivos
    de imagem j&aacute; s&atilde;o compactados. Ent&atilde;o se o pesado do servidor
    &eacute; a transmiss&atilde;o desses dados, habilitar a compacta&ccedil;&atilde;o
    no Apache pode onerar o processamento do servidor e o ganho em banda ser&aacute;
    muito baixo. Ai cabe pesquisar se vale a pena :)"
- id: 31555
  author: Jonny Ken
  author_email: web@jonnyken.com
  author_url: http://migre.me
  date: '2015-05-26 23:47:10 -0300'
  date_gmt: '2015-05-26 23:47:10 -0300'
  content: Acabei de ver que no arquivo est&aacute; mostrando isso, mas mesmo assim
    fica aqui o refor&ccedil;o :p
- id: 36202
  author: Cleiton
  author_email: cleitonzahn.info@gmail.com
  author_url: http://hospedebem.info/
  date: '2015-07-16 01:36:10 -0300'
  date_gmt: '2015-07-16 01:36:10 -0300'
  content: "Muito bom! Me ajudou muito, valeu!!\r\nS&oacute; tive que descartar a
    parte SetEnvIfNoCase Request_URI \r\n.(?:gif|jpe?g|png)$ no-gzip dont-vary, porque
    n&atilde;o funcionou no servidor onde hospedo. Mas o resto, funcionou bem."
- id: 40072
  author: Lucas
  author_email: capanga157@gmail.com
  author_url: ''
  date: '2015-09-04 13:14:10 -0300'
  date_gmt: '2015-09-04 13:14:10 -0300'
  content: "&Oacute;timo, vai me ajudar e muito na otimiza&ccedil;&atilde;o do meu
    site.\r\nObrigado."
- id: 42251
  author: leandro
  author_email: filmesclassicosraros@gmail.com
  author_url: http://filmesclassicosraros.com.br/
  date: '2015-09-30 19:34:47 -0300'
  date_gmt: '2015-09-30 19:34:47 -0300'
  content: otimas explica&ccedil;ao, ajudou muito...
- id: 43502
  author: Fabio
  author_email: fabiomaster0@gmail.com
  author_url: http://planetalar.com.br
  date: '2015-10-15 21:43:58 -0300'
  date_gmt: '2015-10-15 21:43:58 -0300'
  content: "Oi Glauco,\r\nMuito bom seu artigo.\r\nNo caso da hospedagem ser em um
    servidor contratado como Locaweb ou KingHost temos que solicitar ao suporte t&eacute;cnico
    a libera&ccedil;&atilde;o dos m&oacute;dulos mod_deflate e mod_gzip. &Eacute;
    isso?\r\nGrande abra&ccedil;o."
---
<p>Fala pessoal, beleza?</p>

<p>Hoje estou aqui para falar de um assunto que pode não ser muito conhecido por alguns, que é a compactação gzip/deflate.</p>

<p>Essa técnica, nada mais é do que a compactação dos arquivos solicitados pelo navegador (browser) antes deles serem enviados pelo servidor.</p>

<a href="{{ site.baseurl }}/assets/gzip-deflate-compression.jpg"><img class="alignnone  wp-image-490" title="gzip-deflate-compression" src="{{ site.baseurl }}/assets/gzip-deflate-compression.jpg" alt="gzip-deflate-compression"/></a>

<h2>Fluxo de Requisição e Resposta HTTP</h2>

<p>Primeiro vou começar explicando como funciona quando fazemos uma requisição sem utilizar essa compactação, veja a imagem abaixo.</p>

<a href="{{ site.baseurl }}/assets/fluxo-de-requisição-e-resposta-HTTP.gif"><img class="alignnone size-full wp-image-482" title="fluxo-de-requisição-e-resposta-HTTP" src="{{ site.baseurl }}/assets/fluxo-de-requisição-e-resposta-HTTP.gif" alt="fluxo-de-requisição-e-resposta-HTTP"/></a>

<p>Vamos supor que temos um arquivo CSS em nosso site, através do HTML abaixo:</p>

{% highlight html %}
<link rel="stylesheet" href="estilo.css" type="text/css"/>
{% endhighlight %}

<ol>
  <li>navegador solicita o arquivo <code>estilo.css</code> ao servidor</li>
  <li>servidor encontra o arquivo e lê</li>
  <li>servidor retorna o arquivo com código 200 (OK)</li>
  <li>navegador exibe o resultado da página aplicada com o estilo CSS</li>
</ol>

<h2>Otimizando</h2>

<p>Acima temos o fluxo de uma requisição HTTP, funciona muito bem, mas podemos otimizar usando compactação, veja.</p>

<a href="{{ site.baseurl }}/assets/fluxo-de-requisição-e-resposta-HTTP-com-compactacao.gif"><img class="alignnone size-full wp-image-484" title="fluxo-de-requisição-e-resposta-HTTP-com-compactacao" src="{{ site.baseurl }}/assets/fluxo-de-requisição-e-resposta-HTTP-com-compactacao.gif" alt="fluxo-de-requisição-e-resposta-HTTP-com-compactacao"/></a>

<ol>
  <li>navegador solicita o arquivo <code>estilo.css</code> dizendo que aceita compactação gzip</li>
  <li>servidor encontra o arquivo e compacta (aqui está a "mágica")</li>
  <li>servidor responde com o arquivo compactado</li>
  <li>navegador descompacta, e exibe a página com estilo aplicado</li>
</ol>

<p>Bem simples né? Agora invés de fazermos download de um arquivo de 70KB, baixamos apenas 5KB pois usamos a compressão. É uma economia incrível..</p>

<h2>Ativando compressão no Apache</h2>

<p>Como já sabemos o que é a compactação e seu benefício, vamos colocar em prática ativando ela no servidor web Apache.</p>

<p>O Apache tem duas formas de compressão, <code>mod_deflate</code> e <code>mod_gzip</code> (ambos são módulos), irei usar <code>mod_deflate</code> por ser mais simples e mais utilizado, mas fica a seu critério. Para isso precisamos ativar o módulo, caso você esteja no Ubuntu, execute o comando <code>sudo a2enmod deflate</code> e pronto, se você usa Windows com WAMP, basta iniciar o gerenciador do <code>WAMP -&gt; Apache -&gt; Módulos -&gt; mod_deflate</code>, pronto! Não esqueça de reiniciar o Apache após a ativação..</p>

<p>Vou usar meu site (<a title="http://glaucocustodio.com" href="http://glaucocustodio.com" target="_blank">http://glaucocustodio.com</a>) como exemplo prático para ativar a compactação. Abaixo temos uma imagem que mostra uma requisição ao arquivo <code>jquery.js</code> sendo feita sem compactação gzip/deflate, temos que fazer download de 91.7KB.</p>

<a href="{{ site.baseurl }}/assets/analise-de-requisição-sem-compactação.gif"><img class="alignnone size-full wp-image-488" title="analise-de-requisição-sem-compactação" src="{{ site.baseurl }}/assets/analise-de-requisição-sem-compactação.gif" alt="analise-de-requisição-sem-compactação"/></a>

<p>Como já sei que no servidor de meu site o <code>mod_deflate</code> já está ativo, adiciono o código abaixo no arquivo <code>.htaccess</code> na raiz do meu site para ativar a compactação.</p>

{% highlight apache %}
<IfModule mod_deflate.c>
# Insert filter
AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE image/svg+xml
AddOutputFilterByType DEFLATE application/rss+xml
AddOutputFilterByType DEFLATE application/atom_xml
AddOutputFilterByType DEFLATE application/x-javascript
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/x-httpd-php
AddOutputFilterByType DEFLATE application/x-httpd-fastphp
AddOutputFilterByType DEFLATE application/x-httpd-eruby
AddOutputFilterByType DEFLATE text/html

SetOutputFilter DEFLATE

# Netscape 4.x has some problems...
BrowserMatch ^Mozilla/4 gzip-only-text/html

# Netscape 4.06-4.08 have some more problems
BrowserMatch ^Mozilla/4\.0[678] no-gzip

# MSIE masquerades as Netscape, but it is fine
# BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

# NOTE: Due to a bug in mod_setenvif up to Apache 2.0.48
# the above regex won't work. You can use the following
# workaround to get the desired effect:
BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html

# Don't compress images
SetEnvIfNoCase Request_URI \
\.(?:gif|jpe?g|png)$ no-gzip dont-vary
</IfModule>
{% endhighlight %}

<p>Esse código verifica se o módulo deflate está ativo (<code>IfModule</code>), define compactação deflate por tipos através das linhas <code>AddOutputFilterByType..</code>, garante que navegadores antigos (como Netscape 1.0) não terão compactação (pois não suportam a descompressão) e evita que imagens sejam comprimidas, pois a maioria delas já são e não tem necessidade (assim como vídeos e arquivos de áudios).</p>

<p>Após subir o arquivo no servidor e analisar as requisições, veja o que temos.</p>

<p><a href="{{ site.baseurl }}/assets/analise-de-requisição-com-compactação.gif"><img class="alignnone size-full wp-image-487" title="analise-de-requisição-com-compactação" src="{{ site.baseurl }}/assets/analise-de-requisição-com-compactação.gif" alt="analise-de-requisição-com-compactação"/></a></p>

<div class="note">Não esqueça de limpar o cache do navegador para ver o resultado.</div>

<p>Observe a linha <code>Content-Encoding</code> e veja que a compactação <code>deflate/gzip</code> está ativa agora e o mais impressionante é o tamanho do arquivo baixado, apenas 32.4KB, ou seja, reduzimos 2/3 do peso do arquivo apenas com essa técnica..</p>

<p>Espero que tenha ajudado e sido claro nesse tutorial.. O que vocês acharam?</p>

<p>Até mais!</p>
